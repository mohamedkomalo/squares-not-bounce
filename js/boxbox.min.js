/* Copyright 2013 Christophe Rosset. Licensed under the MIT License. http://topheman.github.com/boxbox/ */
/* Copyright 2012 Greg Smith. Licensed under the MIT License. http://incompl.github.com/boxbox/ */
(function(){var e=0,t=["ms","moz","webkit","o"];for(var n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelRequestAnimationFrame=window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,n){var r=(new Date).getTime(),i=Math.max(0,16-(r-e)),s=window.setTimeout(function(){t(r+i)},i);return e=r+i,s}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})})(),function(){function t(e){function t(){}return t.prototype=e,new t}function n(e,t){var r,i,s;e===undefined&&(e={});if(t!==undefined)for(i in t)if(t.hasOwnProperty(i)&&e[i]===undefined)if(Object.prototype.toString.call(t[i])==="[object Array]"){e[i]=[];for(s=0;s<t[i].length;s++)e[i].push(t[i][s])}else typeof t[i]=="object"&&t[i]!==null&&t[i]!==undefined?e[i]=n(e[i],t[i]):e[i]=t[i];return e}function r(e,t,n){var r,i=!0;return e._id>-1?(r=e._world._ops,i=e._ops.active):r=e._ops,i===!1&&t!=="key"?(console.warn(n+" only on active objects"),!1):r.disableKeyEvents===!0&&t==="key"?(console.warn("Key events are disabled, you tried to call "+n),!1):r.disableMouseEvents===!0&&t==="mouse"?(console.warn("Mouse events are disabled, you tried to call "+n),!1):r.disableTouchEvents===!0&&t==="touch"?(console.warn("Touch events are disabled, you tried to call "+n),!1):!0}var e=57.2957795;window.boxbox={},window.boxbox.codeName="boxboxevents",window.boxbox.version="0.1.2";if(Box2D===undefined){console.error("boxbox needs Box2d to work");return}var i=Box2D.Common.Math.b2Vec2,s=Box2D.Common.Math.b2Math,o=Box2D.Dynamics.b2BodyDef,u=Box2D.Dynamics.b2Body,a=Box2D.Dynamics.b2FixtureDef,f=Box2D.Dynamics.b2Fixture,l=Box2D.Dynamics.b2World,c=Box2D.Collision.Shapes,h=Box2D.Dynamics.b2DebugDraw,p=Box2D.Collision.b2AABB;window.boxbox.createWorld=function(e,n){var r=t(g);return r._init(e,n),r};var d={gravity:{x:0,y:10},allowSleep:!0,scale:30,tickFrequency:50,collisionOutlines:!1,disableTouchEvents:!1,disableMouseEvents:!1,disableKeyEvents:!1,preventScroll:!1,_mousePan:{disabled:!0,excludeEntityIds:[],multiplier:1},_touchPan:{disabled:!0,panMultiplier:1,excludeEntityIds:[],triggerWorldEvents:!0,allowPinch:!0},_mousewheelZoom:{disabled:!0,step:.1},boundaries:{top:null,right:null,bottom:null,left:null,maxScale:null},_hasBoundaries:null},v={type:"distance",allowCollisions:!1},m="world",g={_ops:null,_world:null,_canvas:null,_keydownHandlers:{},_keyupHandlers:{},_mousedownHandlers:{},_mouseupHandlers:{},_mousemoveHandlers:{},_mouseinHandlers:{},_mouseoutHandlers:{},_mouseStartdragHandlers:{},_mouseDragHandlers:{},_mouseStopdragHandlers:{},_mousePanStartdragHandler:null,_mousePanDragHandler:null,_mousePanStopdragHandler:null,_touchstartHandlers:{},_touchendHandlers:{},_touchmoveHandlers:{},_touchStartdragHandlers:{},_touchDragHandlers:{},_touchStopdragHandlers:{},_touchAddtouchdragHandlers:{},_touchRemovetouchdragHandlers:{},_touchPanStartdragHandler:null,_touchPanDragHandler:null,_touchPanStopdragHandler:null,_touchPanStartPinchingHandler:null,_touchPanStopPinchingHandler:null,_mousewheelHandlers:{},_startContactHandlers:{},_finishContactHandlers:{},_impactHandlers:{},_destroyQueue:[],_impulseQueue:[],_constantVelocities:{},_constantForces:{},_entities:{},_nextEntityId:0,_cameraX:0,_cameraY:0,_onRender:[],_onTick:[],_creationQueue:[],_positionQueue:[],_pause:!1,_mouseHoverEntityId:null,_mouseDraggingEntityId:null,_touchDraggingEntityIds:[],_mouseDraggableEntityIds:[],_touchDraggableEntityIds:[],_init:function(e,t){var r=this,s,o,u,a;this._ops=n(t,d),this.checkListenersOptions(),this._world=new l(new i(this._ops.gravity.x,this._ops.gravity.y),!0),u=this._world,this._canvas=e,this._ctx=this._canvas.getContext("2d"),this._scale=this._ops.scale,this.viewport=function(e){return{_world:e,getCurrentWindowInfos:function(){var e,t=this._world.camera(),n=this._world.scale();return e={x:t.x,y:t.y,width:this._world._canvas.width/n,height:this._world._canvas.height/n,scale:n},e},getScaledWindowInfos:function(e,t,n){var r={},i=t?t:this.getCurrentWindowInfos(),s=this._world._ops.boundaries,o=this._world._canvas.width,u=this._world._canvas.height,a=o/e,f=u/e,l,c,h,p=!1;return l=(i.width-a)/2+i.x,c=(i.height-f)/2+i.y,h=e,s.top!==null&&s.bottom!==null&&(h>s.maxScale,f>s.bottom-s.top&&(a=a*(s.bottom-s.top)/f,f=s.bottom-s.top,h=this._world._canvas.height/f,p=!0)),s.right!==null&&s.left!==null&&(h>s.maxScale,a>s.right-s.left&&(f=f*(s.right-s.left)/a,a=s.right-s.left,h=this._world._canvas.width/a,p=!0)),r.x=l,r.y=c,r.width=a,r.height=f,r.scale=h,p&&typeof n=="undefined"&&(r=this.getScaledWindowInfos(e,r,!0)),r},getMaxWindowInfos:function(e){var t,n,r,i,s,o,u,a,f,l,c=[],h=[],p,d,v,m,g,y=this._world._canvas.width,b=this._world._canvas.height,w,E,S,x,T=this._world.scale();for(t in this._world._entities){n=this._world._entities[t].position(),i=this._world._entities[t]._body.GetAngle();if(this._world._entities[t]._ops.shape==="circle")r=this._world._entities[t]._ops.radius,c.push(n.x+r),c.push(n.x-r),h.push(n.y+r),h.push(n.y-r);else{s=this._world._entities[t]._body,o=s.GetFixtureList().GetShape().GetVertices(),u={};for(a=0;a<o.length;a++)u[a]=s.GetWorldPoint(o[a]),c.push(u[a].x),h.push(u[a].y)}}return c.sort(function(e,t){return e-t}),h.sort(function(e,t){return e-t}),p=c[0],d=c[c.length-1],v=h[0],m=h[h.length-1],g={x:p,y:v,width:d-p,height:m-v,scale:T},e&&(f=this.getCurrentWindowInfos(),S=g.width,x=g.height,l=S/x,g.width=Math.max(g.height*f.width/f.height,g.width),g.height=Math.max(g.width*f.height/f.width,g.height),g.scale=Math.min(y/S,b/x),l>1?(w=Math.max((g.x-g.width+S)/2,g.x-g.width+S),E=Math.min((g.y-g.height+x)/2,g.y-g.height+x)):(w=Math.min((g.x+g.width-S)/2,g.x+g.width-S),E=Math.max((g.y-g.height+x)/2,g.y-g.height+x),console.warn("Troubles with computing the correct x/y coordinates with stageRatio < 1 worlds")),g.x=w,g.y=E),g},focusAll:function(){var e=this.getMaxWindowInfos(!0);return this._world.camera({x:e.x,y:e.y}),this._world.scale(e.scale),e},checkBoundaries:function(e){var t={x:e.x,y:e.y,width:e.width,height:e.height,scale:e.scale,outOfBounds:!1},n=this._world._ops.boundaries,r=!1,i=0,s=0;return n.left!==null&&e.x<n.left&&(t.x=n.left,r=!0,i++),n.top!==null&&e.y<n.top&&(t.y=n.top,r=!0,s++),n.right!==null&&e.x+e.width>n.right&&(t.x=n.right-e.width,r=!0,i++),n.bottom!==null&&e.y+e.height>n.bottom&&(t.y=n.bottom-e.height,r=!0,s++),i>1?(t.width=n.right-n.left,t.x=n.left,t.scale=this._world._canvas.width/t.width):s>1&&(t.height=n.bottom-n.top,t.y=n.top,t.scale=this._world._canvas.height/t.height),t.outOfBounds=r,t},getWindowInfosCenterTo:function(e,t,n){if(typeof e.x=="undefined"||typeof e.y=="undefined")throw new Error("x and y must be specified in position");var r,i,s,o,u,a=this._world._ops.boundaries,f=t?t:this.getCurrentWindowInfos(),l={},c=!1;return u=f.scale,s=f.width,o=f.height,r=e.y-o/2,i=e.x-s/2,a.top!==null&&a.bottom!==null&&(u>a.maxScale,o>a.bottom-a.top&&(s=s*(a.bottom-a.top)/o,o=a.bottom-a.top,u=this._world._canvas.height/o,c=!0)),a.right!==null&&a.left!==null&&(u>a.maxScale,s>a.right-a.left&&(o=o*(a.right-a.left)/s,s=a.right-a.left,u=this._world._canvas.width/s,c=!0)),l.x=i,l.y=r,l.width=s,l.height=o,l.scale=u,c&&typeof n=="undefined"&&(l=this.getWindowInfosCenterTo(e,l,!0)),this.checkBoundaries(l)},isRestricted:function(){if(this._world._ops._hasBoundaries!==null)return this._world._ops._hasBoundaries;for(var e in Object.keys(this._world._ops.boundaries))if(["top","bottom","left","right"].indexOf(Object.keys(this._world._ops.boundaries)[e])>-1)return this._world._ops._hasBoundaries=!0,!0;return this._world._ops._hasBoundaries=!1,this._world._ops._hasBoundaries},centerToStage:function(){var e=this._world._ops.boundaries,t=null,n={};this.isRestricted()&&(e.right!==null&&e.left!==null?n.x=(e.right-e.left)/2+e.left:e.right!==null?n.x=e.right:e.left!==null?n.x=e.left:(t=t===null?this.getCurrentWindowInfos():t,n.x=t.x+t.width/2),e.top!==null&&e.bottom!==null?n.y=(e.bottom-e.top)/2+e.top:e.top!==null?n.y=e.top:e.bottom!==null?n.y=e.bottom:(t=t===null?this.getCurrentWindowInfos():t,n.y=t.y+t.height/2),this.centerTo(n))},centerTo:function(e){e=e.position?e.position():e;var t=this.getWindowInfosCenterTo(e);return this._world.camera({x:t.x,y:t.y}),this._world.scale(t.scale),t},scaleTo:function(e){var t;t=this.getScaledWindowInfos(e),t.scale>0&&(t=this.checkBoundaries(t),this._world.camera({x:t.x,y:t.y}),this._world.scale(t.scale))}}}(this),this.viewport.centerToStage();if(this._canvas!==undefined){if(this._ops.debugDraw){var f=new h;f.SetSprite(this._canvas.getContext("2d")),f.SetDrawScale(this._scale),f.SetFillAlpha(.3),f.SetLineThickness(1),f.SetFlags(h.e_shapeBit|h.e_jointBit),u.SetDebugDraw(f)}window.setInterval(function(){var e,t;for(e=0;e<r._onTick.length;e++)t=r._onTick[e].ctx,t._destroyed||r._onTick[e].fun.call(t)},this._ops.tickFrequency),function Y(){var e,t,n,s,a,f,l,c;for(e in r._constantVelocities)n=r._constantVelocities[e],n.body.SetLinearVelocity(new i(n.x,n.y),n.body.GetWorldCenter());for(o=0;o<r._impulseQueue.length;o++)s=r._impulseQueue.pop(),s.body.ApplyImpulse(new i(s.x,s.y),s.body.GetWorldCenter());for(e in r._constantForces)a=r._constantForces[e],a.body.ApplyForce(new i(a.x,a.y),a.body.GetWorldCenter());for(e in r._entities)t=r._entities[e],n=t._body.GetLinearVelocity(),n.x>t._ops.maxVelocityX&&(n.x=t._ops.maxVelocityX),n.x<-t._ops.maxVelocityX&&(n.x=-t._ops.maxVelocityX),n.y>t._ops.maxVelocityY&&(n.y=t._ops.maxVelocityY),n.y<-t._ops.maxVelocityY&&(n.y=-t._ops.maxVelocityY);for(o=0;o<r._destroyQueue.length;o++)f=r._destroyQueue.pop(),l=f._id,u.DestroyBody(f._body),f._destroyed=!0,delete r._keydownHandlers[l],delete r._keyupHandlers[l],delete r._mousedownHandlers[l],delete r._mousemoveHandlers[l],delete r._mouseupHandlers[l],delete r._mouseinHandlers[l],delete r._mouseoutHandlers[l],delete r._mouseStartdragHandlers[l],delete r._mouseDragHandlers[l],delete r._mouseStopdragHandlers[l],delete r._touchstartHandlers[l],delete r._touchmoveHandlers[l],delete r._touchendHandlers[l],delete r._touchStartdragHandlers[l],delete r._touchDragHandlers[l],delete r._touchStopdragHandlers[l],delete r._touchAddtouchdragHandlers[l],delete r._touchRemovetouchdragHandlers[l],delete r._mousewheelHandlers[l],delete r._startContactHandlers[l],delete r._finishContactHandlers[l],delete r._impactHandlers[l],r._destroyQueue.splice(l,1),r._impulseQueue.splice(l,1),delete r._constantVelocities[l],delete r._constantForces[l],delete r._entities[l];r._pause===!1?u.Step(1/60,10,10):u.Step(null);for(o=0;o<r._creationQueue.length;o++)r.createEntity(r._creationQueue.pop());for(o=0;o<r._positionQueue.length;o++)c=r._positionQueue.pop(),c.o.position.call(c.o,c.val);r._canvas.width=r._canvas.width;for(e in r._entities)t=r._entities[e],t._draw(r._ctx,t.canvasPosition().x,t.canvasPosition().y);for(o=0;o<r._onRender.length;o++)r._onRender[o].fun.call(r._onRender[o].ctx,r._ctx);u.ClearForces(),u.DrawDebugData(),window.requestAnimationFrame(Y)}();var c=function(e){this.infos=[],this.addDraggingInfos=function(e){this.infos.push(e)},this.getOriginalDraggingInfos=function(){return this.infos[0]},this.getLastDraggingInfos=function(){return this.infos[this.infos.length-1]},this.getViewportInfos=function(e,t){var n=this.getOriginalDraggingInfos(),i=this.getLastDraggingInfos(),s={x:(e.offsetX||e.layerX||e.pageX)/i.viewport.scale,y:(e.offsetY||e.layerY||e.pageY)/i.viewport.scale},o,u;switch(t){case"touch":u=r._ops._touchPan.panMultiplier;break;case"mouse":u=r._ops._mousePan.multiplier;break;default:u=1}return o={originalViewport:{x:n.viewport.x,y:n.viewport.y,width:n.viewport.width,height:n.viewport.height,scale:n.viewport.scale},viewport:{x:i.viewport.x-(s.x-i.relativePointer.x)*u,y:i.viewport.y-(s.y-i.relativePointer.y)*u,width:i.viewport.width,height:i.viewport.height,scale:i.viewport.scale}},o},this.addDraggingInfos(e)},p=function(e,t){t||(t=r.viewport.getCurrentWindowInfos()),this.relativePointer={x:(e.offsetX||e.layerX||e.pageX)/r.scale(),y:(e.offsetY||e.layerY||e.pageY)/r.scale(),identifier:e.idenfier!==null?e.identifier:null},this.viewport={x:t.x,y:t.y,width:t.width,height:t.height,scale:t.scale}};r._ops.disableKeyEvents||(window.addEventListener("keydown",function(e){for(var t in r._keydownHandlers)r._entities[t]._destroyed||r._keydownHandlers[t].call(r._entities[t],e)},!1),window.addEventListener("keyup",function(e){for(var t in r._keyupHandlers)r._entities[t]._destroyed||r._keyupHandlers[t].call(r._entities[t],e)},!1));var v=null,g=function(e){var t=x(e);e.preventDefault(),A(e,t);for(var n in r._mousedownHandlers)n===m?r._mousedownHandlers[n].call(r,e,t):t.entity&&t.entity._id==n&&!t.entity._destroyed&&r._mousedownHandlers[n].call(t.entity,e,t)},y=function(e){var t=x(e);e.preventDefault(),M(e,t);for(var n in r._mouseupHandlers)n===m?r._mouseupHandlers[n].call(r,e,t):t.entity&&t.entity._id==n&&!t.entity._destroyed&&r._mouseupHandlers[n].call(t.entity,e,t)},b=function(e){var t=x(e);e.preventDefault(),O(e,t);for(var n in r._mousemoveHandlers)n===m?r._mousemoveHandlers[n].call(r,e,t):t.entity&&t.entity._id==n&&!t.entity._destroyed&&r._mousemoveHandlers[n].call(t.entity,e,t)},w=function(e){var t=x(e);e.preventDefault(),H(e,t),r._mouseinHandlers[m]&&r._mouseinHandlers[m].call(r,e,t)},E=function(e){var t=x(e);e.preventDefault(),B(e,t),r._mouseoutHandlers[m]&&r._mouseoutHandlers[m].call(r,e,t)},S=function(e){var t=x(e),n=Math.max(-1,Math.min(1,e.wheelDelta||-e.detail)),i=!0;e.preventDefault(),t.delta=n;for(var s in r._mousewheelHandlers)s===m?r._mousewheelHandlers[s].call(r,e,t):t.entity&&t.entity._id==s&&!t.entity._destroyed&&(r._mousewheelHandlers[s].call(r._entities[s],e,t),i=!1);j(e,t,i),e.preventDefault()},x=function(e){var t=r.calculateWorldPositionFromPointer(e),n=t.x,i=t.y;return t.entity=r.getEntityByPosition(n,i),t},T=function(e){var t=r.calculateWorldPositionFromPointer(e),n=t.x,i=t.y;return t.entity=r.getEntityByPosition(n,i),t.touchIdentifier=e.identifier,t},N=function(e){var t=[],n;for(n=0;n<e.changedTouches.length;n++)e.changedTouches[n]&&t.push(T(e.changedTouches[n]));return t},C=function(e){if(v===e.changedTouches[0].identifier)return v=null,!1;v=e.changedTouches[0].identifier;var t=N(e),n,i,s=r.isAllowedToTriggerTouchEvents(),o=r.isTouchNotPanningNorPinching();_(e,t);for(i in r._touchstartHandlers)if(i===m&&s)r._touchstartHandlers[i].call(r,e,t);else if(o)for(n in t)t[n].entity&&t[n].entity._id==i&&!t[n].entity._destroyed&&r._touchstartHandlers[i].call(t[n].entity,e,t[n]);e.preventDefault()},k=function(e){var t=N(e),n,i,s=r.isAllowedToTriggerTouchEvents(),o=r.isTouchNotPanningNorPinching();D(e,t);for(i in r._touchmoveHandlers)if(i===m&&s)r._touchmoveHandlers[i].call(r,e,t);else if(o)for(n in t)t[n].entity&&t[n].entity._id==i&&!t[n].entity._destroyed&&r._touchmoveHandlers[i].call(t[n].entity,e,t[n]);e.preventDefault()},L=function(e){v===e.changedTouches[0].identifier&&(v=null);var t=N(e),n,i,s=r.isAllowedToTriggerTouchEvents(),o=r.isTouchNotPanningNorPinching();P(e,t);for(i in r._touchendHandlers)if(i===m&&s)r._touchendHandlers[i].call(r,e,t);else if(o)for(n in t)t[n].entity&&t[n].entity._id==i&&!t[n].entity._destroyed&&r._touchendHandlers[i].call(t[n].entity,e,t[n])},A=function(e,t){r._mouseDraggingEntityId===null&&t.entity!==null&&t.entity._ops._mouseDraggable.disabled===!1&&F.call(t.entity,e,t),r._ops._mousePan.disabled===!1&&r._mouseDraggingEntityId===null&&(t.entity===null||r._ops._mousePan.excludeEntityIds.indexOf(t.entity._id)===-1)&&J.call(r,e,t)},O=function(e,t){r._mouseDraggingEntityId!==null&&r._entities[r._mouseDraggingEntityId]._mouseDragging&&F.call(r._entities[r._mouseDraggingEntityId],e,t),r._ops._mousePan.disabled===!1&&r._mousePanDragging&&J.call(r,e,t);var n=r._mouseHoverEntityId,i=null;for(var s in r._entities)!r._entities[s]._destroyed&&r._entities[s].checkPosition(t.x,t.y)&&(i=s);r._mouseHoverEntityId=i,n===null&&i!==null&&r._mouseinHandlers[i]&&r._mouseinHandlers[i].call(r._entities[i],e,t),n!==null&&i===null&&r._mouseoutHandlers[n]&&r._mouseoutHandlers[n].call(r._entities[n],e,t)},M=function(e,t){r._mouseDraggingEntityId!==null&&r._entities[r._mouseDraggingEntityId]._mouseDragging&&I.call(r._entities[r._mouseDraggingEntityId],e,t),r._ops._mousePan.disabled===!1&&r._mousePanDragging&&K.call(r,e,t)},_=function(e,t){var n;if(r.isTouchNotPanningNorPinching()&&t.length>0)for(n in t)t[n].entity&&t[n].entity._ops._touchDraggable.disabled===!1&&X.call(r._entities[t[n].entity._id],e,t,n);e.touches.length===1&&r.isTouchNotPanningNorPinching()&&r._ops._touchPan.disabled===!1&&r._touchDraggingEntityIds.length===0?Q.call(r,e,t):e.touches.length===2&&r.isTouchPanning()&&r._ops._touchPan.allowPinch===!0&&r._touchDraggingEntityIds.length===0&&Q.call(r,e,t,{pinching:!0})},D=function(e,t){W=[];var n,i,s,o;if(r._touchDraggingEntityIds.length>0)for(n=0;n<e.changedTouches.length;n++)for(i in r._touchDraggingEntityIds)for(s in r._entities[r._touchDraggingEntityIds[i]]._touchMoveJoints)if(s==e.changedTouches[n].identifier)for(o=0;o<t.length;o++)t[o].touchIdentifier==s&&(W.indexOf(r._touchDraggingEntityIds[i])===-1&&W.push(r._touchDraggingEntityIds[i]),X.call(r._entities[r._touchDraggingEntityIds[i]],e,t,o));if(W.length>0)for(n=0;n<W.length;n++)r._touchDragHandlers[W[n]]&&r._touchDragHandlers[W[n]].call(r._entities[W[n]],e,R(t,r._entities[W[n]]));r._ops._touchPan.disabled===!1&&!r.isTouchNotPanningNorPinching()&&Q.call(r,e,t)},P=function(e,t){var n,i,s,o;if(r._touchDraggingEntityIds.length>0)for(n=0;n<e.changedTouches.length;n++)for(i in r._touchDraggingEntityIds)for(s in r._entities[r._touchDraggingEntityIds[i]]._touchMoveJoints)if(s==e.changedTouches[n].identifier)for(o=0;o<t.length;o++)t[o].touchIdentifier==s&&V.call(r._entities[r._touchDraggingEntityIds[i]],e,t,o);r.isTouchNotPanningNorPinching()||G.call(r,e,t)},H=function(e,t){t.entity&&r._mouseinHandlers[t.entity._id]&&r._mouseinHandlers[t.entity._id].call(r._entities[t.entity._id],e,t)},B=function(e,t){r._mouseDraggingEntityId!==null&&r._entities[r._mouseDraggingEntityId]._mouseDragging&&I.call(r._entities[r._mouseDraggingEntityId],e,t),r._mousePanDragging&&K.call(r,e,t),r._mouseHoverEntityId!==null&&r._mouseoutHandlers[r._mouseHoverEntityId]&&r._mouseoutHandlers[r._mouseHoverEntityId].call(r._entities[r._mouseHoverEntityId],e,t)},j=function(e,t,n){var i,s;n===!0&&r._ops._mousewheelZoom.disabled===!1&&(s=r.scale()+t.delta*r._ops._mousewheelZoom.step,r._ops.boundaries.maxScale!==null&&s>r._ops.boundaries.maxScale&&(s=r._ops.boundaries.maxScale),i=r.viewport.getScaledWindowInfos(s),r._mousePanDragging&&r._mousePanDragging.addDraggingInfos(new p(e,i)),i.scale>0&&(i=r.viewport.checkBoundaries(i),r.camera({x:i.x,y:i.y}),r.scale(i.scale)))},F=function(e,t){if(r._mouseDraggingEntityId===null&&!this._mouseDragging&&!this._mouseStartDrag){this._mouseDragging=t,this._mouseStartDrag=!0,r._mouseDraggingEntityId=this._id;if(this._ops._mouseDraggable.type==="regularDrag"){if(!this._mouseMoveJoint){var n=new Box2D.Dynamics.Joints.b2MouseJointDef;n.bodyA=r._world.GetGroundBody(),n.bodyB=this._body,n.target.Set(t.x,t.y),n.maxForce=1e28,n.timeStep=1/60,this._mouseMoveJoint=r._world.CreateJoint(n)}}else this._ops._mouseDraggable.type==="eventDrag"}else this._mouseDragging&&(this._mouseStartDrag&&e.type==="mousemove"?(r._mouseStartdragHandlers[this._id]&&r._mouseStartdragHandlers[this._id].call(this,e,q(t,this._mouseDragging)),this._mouseStartDrag=!1):r._mouseDragHandlers[this._id]&&r._mouseDragHandlers[this._id].call(this,e,q(t,this._mouseDragging)));this._mouseMoveJoint&&this._mouseMoveJoint.SetTarget(new Box2D.Common.Math.b2Vec2(t.x,t.y))},I=function(e,t){this._mouseDragging&&(this._mouseMoveJoint&&(r._world.DestroyJoint(this._mouseMoveJoint),this._mouseMoveJoint=null),this._mouseStartDrag===!1&&r._mouseStopdragHandlers[this._id]&&r._mouseStopdragHandlers[this._id].call(this,e,q(t,this._mouseDragging))),this._mouseStartDrag=!1,this._mouseDragging=!1,r._mouseDraggingEntityId=null},q=function(e,t){var n={};return n.position={},n.position.x=e.x,n.position.y=e.y,t&&(n.originalPosition={},n.originalPosition.x=t.x,n.originalPosition.y=t.y),n},R=function(e,t){var n=t._id,r=[],i,s;for(i=0;i<e.length;i++)for(s in t._touchMoveJoints)s==e[i].touchIdentifier&&r.push({touchIdentifier:s,originalPosition:t._touchMoveJoints[s].originalPosition,position:{x:e[i].x,y:e[i].y}});return r},U=function(e,t,n){var i,s;this._touchMoveJoints||(this._touchMoveJoints={}),this._touchMoveJoints[t[n].touchIdentifier]&&this._touchMoveJoints[t[n].touchIdentifier].joint&&r._world.DestroyJoint(this._touchMoveJoints[t[n].touchIdentifier].joint),this._touchMoveJoints[t[n].touchIdentifier]={originalPosition:{x:t[n].x,y:t[n].y}},this._ops._touchDraggable.type==="regularDrag"?(i=new Box2D.Dynamics.Joints.b2MouseJointDef,i.bodyA=r._world.GetGroundBody(),i.bodyB=this._body,i.target.Set(t[n].x,t[n].y),i.maxForce=1e28,i.timeStep=1/60,this._touchMoveJoints[t[n].touchIdentifier].joint=r._world.CreateJoint(i)):this._ops._touchDraggable.type==="eventDrag",s=Object.keys(this._touchMoveJoints).length,s>1&&r._touchAddtouchdragHandlers[this._id]&&r._touchAddtouchdragHandlers[this._id].call(this,e,R(t,this)[0],s)},z=function(e,t,n){var i,s=R(t,this)[0];this._touchMoveJoints[t[n].touchIdentifier]&&(this._touchMoveJoints[t[n].touchIdentifier].joint&&r._world.DestroyJoint(this._touchMoveJoints[t[n].touchIdentifier].joint),this._touchMoveJoints[t[n].touchIdentifier]=null,delete this._touchMoveJoints[t[n].touchIdentifier]),i=Object.keys(this._touchMoveJoints).length,i>0&&r._touchRemovetouchdragHandlers[this._id]&&r._touchRemovetouchdragHandlers[this._id].call(this,e,s,i)},W=[],X=function(e,t,n){e.type==="touchstart"&&r._touchDraggingEntityIds.indexOf(this._id)===-1&&!this._touchDragging&&!this._touchStartDrag?(this._body.SetSleepingAllowed(!1),this._touchDragging=!0,this._touchStartDrag=!0,r._touchDraggingEntityIds.push(this._id),U.call(this,e,t,n)):e.type==="touchstart"&&r._touchDraggingEntityIds.indexOf(this._id)>-1?Object.keys(this._touchMoveJoints).length<this._ops._touchDraggable.maxTouches&&U.call(this,e,t,n):this._touchDragging&&this._touchStartDrag&&e.type==="touchmove"&&(r._touchStartdragHandlers[this._id]&&r._touchStartdragHandlers[this._id].call(this,e,R(t,this)[0]),this._touchStartDrag=!1),this._touchMoveJoints&&this._touchMoveJoints[t[n].touchIdentifier]&&this._touchMoveJoints[t[n].touchIdentifier].joint&&this._touchMoveJoints[t[n].touchIdentifier].joint.SetTarget(new Box2D.Common.Math.b2Vec2(t[n].x,t[n].y))},V=function(e,t,n){var i=R(t,this)[0];z.call(this,e,t,n),Object.keys(this._touchMoveJoints).length===0&&(this._body.SetSleepingAllowed(!0),this._touchStartDrag===!1&&r._touchStopdragHandlers[this._id]&&r._touchStopdragHandlers[this._id].call(this,e,i),this._touchStartDrag=!1,this._touchDragging=!1,r._touchDraggingEntityIds.splice(r._touchDraggingEntityIds.indexOf(this._id),1))},$=function(e,t){var n=e.offsetX||e.layerX||e.pageX,r=e.offsetY||e.layerY||e.pageY,i=t.offsetX||t.layerX||t.pageX,s=t.offsetY||t.layerY||t.pageY;return Math.sqrt(Math.pow(n-i,2)+Math.pow(r-s,2))},J=function(e){var t;!this._mousePanDragging&&!this._mousePanStartDrag?(this._mousePanDragging=new c(new p(e)),this._mousePanStartDrag=!0):this._mousePanDragging&&(t=this._mousePanDragging.getViewportInfos(e,"mouse"),t.viewport=this.viewport.checkBoundaries(t.viewport),this.camera({x:t.viewport.x,y:t.viewport.y}),this._mousePanStartDrag&&e.type==="mousemove"?(this._mousePanStartdragHandler&&this._mousePanStartdragHandler.call(this,e,t),this._mousePanStartDrag=!1):this._mousePanDragHandler&&this._mousePanDragHandler.call(this,e,t))},K=function(e,t){var n;this._mousePanDragging&&(n=this._mousePanDragging.getViewportInfos(e,"mouse"),this._mousePanStartDrag===!1&&this._mousePanStopdragHandler&&this._mousePanStopdragHandler.call(this,e,n,"stop"),n.viewport=this.viewport.checkBoundaries(n.viewport),this.camera({x:n.viewport.x,y:n.viewport.y})),this._mousePanStartDrag=!1,this._mousePanDragging=!1},Q=function(e,t,n){var r,i,s,o,u;!this._touchPanDragging&&!this._touchPanStartDrag?(this._touchPanDragging=new c(new p(e.touches[0])),this._touchPanStartDrag=!0):this._touchPanDragging&&(o=this._touchPanDragging.getOriginalDraggingInfos().relativePointer.identifier,r=this._touchPanDragging.getViewportInfos(e.touches[0],"touch"),this._touchPanDragging.pinchingInfos&&!this._touchPanDragging.pinchingInfos.startPinching&&(s=Math.round(100*$(e.touches[0],e.touches[1])*this._touchPanDragging.pinchingInfos.baseScale/this._touchPanDragging.pinchingInfos.baseRange)/100,r.viewport=this.viewport.getScaledWindowInfos(s,r.viewport,!0)),r.viewport=this.viewport.checkBoundaries(r.viewport),this.camera({x:r.viewport.x,y:r.viewport.y}),s&&this.scale(r.viewport.scale),this._touchPanStartDrag&&(e.type==="touchmove"&&e.changedTouches[0].identifier===o||e.type==="touchstart"&&e.changedTouches[0].identifier!==o)?(this._touchPanStartdragHandler&&this._touchPanStartdragHandler.call(this,e,r),this._touchPanStartDrag=!1):this._touchPanDragging.pinchingInfos&&this._touchPanDragging.pinchingInfos.startPinching===!0?(this._touchPanStartPinchingHandler&&this._touchPanStartPinchingHandler.call(this,e,r),this._touchPanDragging.pinchingInfos.startPinching=!1):this._touchPanDragHandler&&this._touchPanDragHandler.call(this,e,r)),this._touchPanDragging&&!this._touchPanDragging.pinchingInfos&&this._ops._touchPan.allowPinch===!0&&e.touches.length>1&&(this._touchPanDragging.pinchingInfos={},this._touchPanDragging.pinchingInfos.baseRange=$(e.touches[0],e.touches[1]),this._touchPanDragging.pinchingInfos.baseScale=this.scale(),this._touchPanDragging.pinchingInfos.startPinching=!0,this._touchPanDragging.pinchingInfos.identifier=e.touches[1].identifier,this._touchPanDragging.addDraggingInfos(new p(e.touches[0])))},G=function(e,t){var n,r,i,s;i=this._touchPanDragging?this._touchPanDragging.getOriginalDraggingInfos().relativePointer.identifier:null,this._touchPanDragging&&i===e.changedTouches[0].identifier?(this._touchPanDragging.pinchingInfos&&(this._touchPanDragging.addDraggingInfos(new p(e.changedTouches[0])),s=!0),n=this._touchPanDragging.getViewportInfos(e.changedTouches[0],"touch"),n.viewport=this.viewport.checkBoundaries(n.viewport),this.camera({x:n.viewport.x,y:n.viewport.y}),s&&this.scale(n.viewport.scale),this._touchPanDragging.pinchingInfos&&this._touchPanStopPinchingHandler&&this._touchPanStopPinchingHandler.call(this,e,n,"stop"),this._touchPanStartDrag===!1&&this._touchPanStopdragHandler&&this._touchPanStopdragHandler.call(this,e,n,"stop"),this._touchPanStartDrag=!1,this._touchPanDragging=!1):this._touchPanDragging&&this._touchPanDragging.pinchingInfos&&this._touchPanDragging.pinchingInfos.identifier===e.changedTouches[0].identifier&&(this._touchPanDragging.addDraggingInfos(new p(e.touches[0])),this._touchPanDragging.pinchingInfos.startPinching!==!0&&(n=this._touchPanDragging.getViewportInfos(e.touches[0],"touch"),this._touchPanDragging.pinchingInfos&&!this._touchPanDragging.pinchingInfos.startPinching&&(r=Math.round(100*$(e.touches[0],e.changedTouches[0])*this._touchPanDragging.pinchingInfos.baseScale/this._touchPanDragging.pinchingInfos.baseRange)/100,n.viewport=this.viewport.getScaledWindowInfos(r,n.viewport,!0)),n.viewport=this.viewport.checkBoundaries(n.viewport),this.camera({x:n.viewport.x,y:n.viewport.y}),r&&this.scale(n.viewport.scale),this._touchPanStopPinchingHandler&&this._touchPanStopPinchingHandler.call(this,e,n,"stop")),this._touchPanDragging.pinchingInfos=!1)};r._ops.disableTouchEvents||(r._canvas.addEventListener("touchstart",C,!1),r._canvas.addEventListener("touchmove",k,!1),r._canvas.addEventListener("touchend",L,!1)),r._ops.disableMouseEvents||(r._canvas.addEventListener("mousedown",g,!1),r._canvas.addEventListener("mouseup",y,!1),r._canvas.addEventListener("mousemove",b,!1),r._canvas.addEventListener("mouseover",w,!1),r._canvas.addEventListener("mouseout",E,!1),r._canvas.addEventListener("mousewheel",S,!1),r._canvas.addEventListener("DOMMouseScroll",S,!1)),r._ops.preventScroll&&document.body.addEventListener("touchmove",function(e){e.preventDefault()},!1),a=new Box2D.Dynamics.b2ContactListener,a.BeginContact=function(e){var t=r._entities[e.GetFixtureA().GetBody()._bbid],n=r._entities[e.GetFixtureB().GetBody()._bbid];for(var i in r._startContactHandlers)t._id===Number(i)&&!t._destroyed&&r._startContactHandlers[i].call(r._entities[i],n),n._id===Number(i)&&!n._destroyed&&r._startContactHandlers[i].call(r._entities[i],t)},a.EndContact=function(e){var t=r._entities[e.GetFixtureA().GetBody()._bbid],n=r._entities[e.GetFixtureB().GetBody()._bbid];for(var i in r._finishContactHandlers)t._id===Number(i)&&!t._destroyed&&r._finishContactHandlers[i].call(r._entities[i],n),n._id===Number(i)&&!n._destroyed&&r._finishContactHandlers[i].call(r._entities[i],t)},a.PostSolve=function(e,t){var n=r._entities[e.GetFixtureA().GetBody()._bbid],i=r._entities[e.GetFixtureB().GetBody()._bbid];for(var s in r._impactHandlers)n._id===Number(s)&&!n._destroyed&&r._impactHandlers[s].call(r._entities[s],i,t.normalImpulses[0],t.tangentImpulses[0]),i._id===Number(s)&&!i._destroyed&&r._impactHandlers[s].call(r._entities[s],n,t.normalImpulses[0],t.tangentImpulses[0])},u.SetContactListener(a)}},checkListenersOptions:function(){var e=[];this._ops.disableTouchEvents&&this._ops.disableMouseEvents&&this._ops.disableKeyEvents&&("ontouchstart"in window&&(this._ops.disableTouchEvents=!1,e.push("touchEvents")),"mousedown"in window&&(this._ops.disableMouseEvents=!1,e.push("mouseEvents")),"onkeydown"in window&&(this._ops.disableKeyEvents=!1,e.push("keyEvents")),console.warn('All events were disabled in your config. The following available events on your device have been enabled : "'+e.join(", ")+'"'))},pause:function(){this._pause===!1?this._pause=!0:this._pause=!1},cleanup:function(e){var t,r,s=this._world,o,u,a=this;for(t in this._entities)o=this._entities[t],u=o._id,s.DestroyBody(o._body),o._destroyed=!0,delete a._keydownHandlers[u],delete a._keyupHandlers[u],delete a._mousedownHandlers[u],delete a._mousemoveHandlers[u],delete a._mouseupHandlers[u],delete a._mouseinHandlers[u],delete a._mouseoutHandlers[u],delete a._mouseStartdragHandlers[u],delete a._mouseDragHandlers[u],delete a._mouseStopdragHandlers[u],delete a._touchstartHandlers[u],delete a._touchmoveHandlers[u],delete a._touchendHandlers[u],delete a._touchStartdragHandlers[u],delete a._touchDragHandlers[u],delete a._touchStopdragHandlers[u],delete a._touchAddtouchdragHandlers[u],delete a._touchRemovetouchdragHandlers[u],delete a._mousewheelHandlers[u],delete a._startContactHandlers[u],delete a._finishContactHandlers[u],delete a._impactHandlers[u],delete a._constantVelocities[u],delete a._constantForces[u],delete a._entities[u];e=e||{},a._ops=n(e,d),a._world.SetGravity(new i(a._ops.gravity.x,a._ops.gravity.y)),a._scale=a._ops.scale,a._destroyQueue=[],a._impulseQueue=[],a._keyupHandlers={},a._mousedownHandlers={},a._mouseupHandlers={},a._mousemoveHandlers={},a._mouseinHandlers={},a._mouseoutHandlers={},a._mouseStartdragHandlers={},a._mouseDragHandlers={},a._mouseStopdragHandlers={},a._mousePanStartdragHandler=null,a._mousePanDragHandler=null,a._mousePanStopdragHandler=null,a._touchstartHandlers={},a._touchendHandlers={},a._touchmoveHandlers={},a._touchStartdragHandlers={},a._touchDragHandlers={},a._touchStopdragHandlers={},a._touchAddtouchdragHandlers={},a._touchRemovetouchdragHandlers={},a._touchPanStartdragHandler=null,a._touchPanDragHandler=null,a._touchPanStopdragHandler=null,a._touchPanStartPinchingHandler=null,a._touchPanStopPinchingHandler=null,a._mousewheelHandlers={},a._startContactHandlers={},a._finishContactHandlers={},a._impactHandlers={},a._destroyQueue=[],a._impulseQueue=[],a._constantVelocities={},a._constantForces={},a._entities={},a._nextEntityId=0,a._cameraX=0,a._cameraY=0,a._onRender=[],a._onTick=[],a._creationQueue=[],a._positionQueue=[],a._pause=!1,a._mouseHoverEntityId=null,a._mouseDraggingEntityId=null,a._touchDraggingEntityIds=[],a._mouseDraggableEntityIds=[],a._touchDraggableEntityIds=[],a.viewport.centerToStage()},_addKeydownHandler:function(e,t){this._keydownHandlers[e]=t},_addKeyupHandler:function(e,t){this._keyupHandlers[e]=t},_addMousedownHandler:function(e,t){this._mousedownHandlers[e]=t},_addMouseupHandler:function(e,t){this._mouseupHandlers[e]=t},_addMousemoveHandler:function(e,t){this._mousemoveHandlers[e]=t},_removeMousedownHandler:function(e){delete this._mousedownHandlers[e]},_removeMouseupHandler:function(e){delete this._mouseupHandlers[e]},_removeMousemoveHandler:function(e){delete this._mousemoveHandlers[e]},_addTouchstartHandler:function(e,t){this._touchstartHandlers[e]=t},_addTouchendHandler:function(e,t){this._touchendHandlers[e]=t},_addTouchmoveHandler:function(e,t){this._touchmoveHandlers[e]=t},_removeTouchstartHandler:function(e){delete this._touchstartHandlers[e]},_removeTouchendHandler:function(e){delete this._touchendHandlers[e]},_removeTouchmoveHandler:function(e){delete this._touchmoveHandlers[e]},_addMouseStartdragHandler:function(e,t){this._mouseStartdragHandlers[e]=t},_addMouseDragHandler:function(e,t){this._mouseDragHandlers[e]=t},_addMouseStopdragHandler:function(e,t){this._mouseStopdragHandlers[e]=t},_addMouseinHandler:function(e,t){this._mouseinHandlers[e]=t},_addMouseoutHandler:function(e,t){this._mouseoutHandlers[e]=t},_removeMouseinHandler:function(e){delete this._mouseinHandlers[e]},_removeMouseoutHandler:function(e){delete this._mouseoutHandlers[e]},_removeMouseStartdragHandler:function(e){delete this._mouseStartdragHandlers[e]},_removeMouseDragHandler:function(e){delete this._mouseDragHandlers[e]},_removeMouseStopdragHandler:function(e){delete this._mouseStopdragHandlers[e]},_addTouchStartdragHandler:function(e,t){this._touchStartdragHandlers[e]=t},_addTouchDragHandler:function(e,t){this._touchDragHandlers[e]=t},_addTouchStopdragHandler:function(e,t){this._touchStopdragHandlers[e]=t},_removeTouchStartdragHandler:function(e){delete this._touchStartdragHandlers[e]},_removeTouchDragHandler:function(e){delete this._touchDragHandlers[e]},_removeTouchStopdragHandler:function(e){delete this._touchStopdragHandlers[e]},_addTouchAddtouchDragHandler:function(e,t){this._touchAddtouchdragHandlers[e]=t},_addTouchRemovetouchDragHandler:function(e,t){this._touchRemovetouchdragHandlers[e]=t},_removeTouchAddtouchDragHandler:function(e){delete this._touchAddtouchdragHandlers[e]},_removeTouchRemovetouchDragHandler:function(e){delete this._touchRemovetouchdragHandlers[e]},_addMousewheelHandler:function(e,t){this._mousewheelHandlers[e]=t},_removeMousewheelHandler:function(e){delete this._mousewheelHandlers[e]},_addStartContactHandler:function(e,t){this._startContactHandlers[e]=t},_addFinishContactHandler:function(e,t){this._finishContactHandlers[e]=t},_addImpactHandler:function(e,t){this._impactHandlers[e]=t},_destroy:function(e){this._destroyQueue.push(e)},_applyImpulse:function(e,t,n,r){this._impulseQueue.push({id:e,body:t,x:n,y:r})},_setConstantVelocity:function(e,t,n,r,i){this._constantVelocities[e+t]={id:t,body:n,x:r,y:i}},_clearConstantVelocity:function(e,t){delete this._constantVelocities[e+t]},_setConstantForce:function(e,t,n,r,i){this._constantForces[e+t]={id:t,body:n,x:r,y:i}},_clearConstantForce:function(e,t){delete this._constantForces[e+t]},_addMouseDraggableEntityId:function(e){this._mouseDraggableEntityIds.indexOf(e)===-1&&this._mouseDraggableEntityIds.push(e)},_addTouchDraggableEntityId:function(e){this._touchDraggableEntityIds.indexOf(e)===-1&&this._touchDraggableEntityIds.push(e)},_removeMouseDraggableEntityId:function(e){var t=this._mouseDraggableEntityIds.indexOf(e);t>-1&&this._mouseDraggableEntityIds.splice(t,1)},_removeTouchDraggableEntityId:function(e){var t=this._touchDraggableEntityIds.indexOf(e);t>-1&&this._touchDraggableEntityIds.splice(t,1)},_addMousePanExcludeEntityId:function(e){this._ops._mousePan.excludeEntityIds.indexOf(e)===-1&&this._ops._mousePan.excludeEntityIds.push(e)},_addTouchPanExcludeEntityId:function(e){this._ops._touchPan.excludeEntityIds.indexOf(e)===-1&&this._ops._touchPan.excludeEntityIds.push(e)},_removeMousePanExcludeEntityId:function(e){var t=this._ops._mousePan.excludeEntityIds.indexOf(e);t>-1&&this._ops._mousePan.excludeEntityIds.splice(t,1)},_removeTouchPanExcludeEntityId:function(e){var t=this._ops._touchPan.excludeEntityIds.indexOf(e);t>-1&&this._ops._touchPan.excludeEntityIds.splice(t,1)},calculateWorldPositionFromPointer:function(e){return{x:(e.offsetX||(e.layerX?e.clientX-e.target.offsetLeft:!1)||e.pageX)/this.scale()+this._cameraX,y:(e.offsetY||(e.layerY?e.clientY-e.target.offsetTop:!1)||e.pageY)/this.scale()+this._cameraY}},gravity:function(e){e!==undefined&&this._world.SetGravity(new i(0,e));var t=this._world.GetGravity();return{x:t.x,y:t.y}},createEntity:function(){var e={},r=Array.prototype.slice.call(arguments);r.reverse();for(var i in r)n(e,r[i]);if(this._world.IsLocked()){this._creationQueue.push(e);return}var s=t(b),o=this._nextEntityId++;return s._init(this,e,o),this._entities[o]=s,s},createJoint:function(e,t,r){r=r||{},r=n(r,v);var i=r.type,s;i==="distance"?s=new Box2D.Dynamics.Joints.b2DistanceJointDef:i==="revolute"?s=new Box2D.Dynamics.Joints.b2RevoluteJointDef:i==="gear"?s=new Box2D.Dynamics.Joints.b2GearJointDef:i==="friction"?s=new Box2D.Dynamics.Joints.b2FrictionJointDef:i==="prismatic"?s=new Box2D.Dynamics.Joints.b2PrismaticJointDef:i==="weld"?s=new Box2D.Dynamics.Joints.b2WeldJointDef:i==="pulley"?s=new Box2D.Dynamics.Joints.b2PulleyJointDef:i==="mouse"?s=new Box2D.Dynamics.Joints.b2MouseJointDef:i==="line"&&(s=new Box2D.Dynamics.Joints.b2LineJointDef),r.enableMotor&&(s.enableMotor=!0);var o=e._body.GetWorldCenter();r.jointPositionOnEntity1&&(o.x+=r.jointPositionOnEntity1.x,o.y+=r.jointPositionOnEntity1.y);var u=t._body.GetWorldCenter();r.jointPositionOnEntity2&&(u.x+=r.jointPositionOnEntity2.x,u.y+=r.jointPositionOnEntity2.y),i==="mouse"?(s.bodyA=e._body,s.bodyB=t._body):s.Initialize&&s.Initialize(e._body,t._body,o,u),r.allowCollisions&&(s.collideConnected=!0),this._world.CreateJoint(s)},find:function(e,t,n,r){n===undefined&&(n=e),r===undefined&&(r=t);var i=this,s=[],o=new p;return o.lowerBound.Set(e,t),o.upperBound.Set(n,r),this._world.QueryAABB(function(e){return s.push(i._entities[e.GetBody()._bbid]),!0},o),s},getEntityByPosition:function(e,t){var n=null;return this._world.QueryPoint(function(e){n=e.GetBody()},new i(e,t)),n!==null&&this._entities[n._bbid]?this._entities[n._bbid]:null},getEntityById:function(e){return this._entities[e]?this._entities[e]:null},getEntityByName:function(e){for(var t in this._entities)if(this._entities[t]._name===e)return this._entities[t];return null},camera:function(e){e=e||{};if(e.x===undefined&&e.y===undefined)return{x:this._cameraX,y:this._cameraY};e.x!==undefined&&(this._cameraX=e.x),e.y!==undefined&&(this._cameraY=e.y)},onRender:function(e){this._onRender.push({fun:e,ctx:this})},unbindOnRender:function(e){var t=[],n;for(n=0;n<this._onRender.length;n++)this._onRender[n].fun!==e&&t.push(this._onRender[n]);this._onRender=t},onTick:function(e){this._onTick.push({fun:e,ctx:this})},unbindOnTick:function(e){var t=[],n;for(n=0;n<this._onTick.length;n++)this._onTick[n].fun!==e&&t.push(this._onTick[n]);this._onTick=t},scale:function(e){return e!==undefined&&(this._scale=e),this._scale},canvasPositionAt:function(e,t){var n=this.camera(),r=this.scale();return{x:Math.round((e+ -n.x)*r),y:Math.round((t+ -n.y)*r)}},onMousedown:function(e){if(r(this,"mouse","onMousedown")===!1)return!1;this._addMousedownHandler(m,e)},onMouseup:function(e){if(r(this,"mouse","onMouseup")===!1)return!1;this._addMouseupHandler(m,e)},onMousemove:function(e){if(r(this,"mouse","onMousemove")===!1)return!1;this._addMousemoveHandler(m,e)},unbindOnMousedown:function(){this._removeMousedownHandler(m)},unbindOnMouseup:function(){this._removeMouseupHandler(m)},unbindOnMousemove:function(){this._removeMousemoveHandler(m)},onMousein:function(e){if(r(this,"mouse","onMousein")===!1)return!1;this._addMouseinHandler(m,e)},onMouseout:function(e){if(r(this,"mouse","onMouseout")===!1)return!1;this._addMouseoutHandler(m,e)},unbindOnMousein:function(){this._removeMouseinHandler(m)},unbindOnMouseout:function(){this._removeMouseoutHandler(m)},onTouchstart:function(e){if(r(this,"touch","onTouchstart")===!1)return!1;this._addTouchstartHandler(m,e)},onTouchmove:function(e){if(r(this,"touch","onTouchmove")===!1)return!1;this._addTouchmoveHandler(m,e)},onTouchend:function(e){if(r(this,"touch","onTouchend")===!1)return!1;this._addTouchendHandler(m,e)},unbindOnTouchstart:function(){this._removeTouchstartHandler(m)},unbindOnTouchmove:function(e){this._removeTouchmoveHandler(m)},unbindOnTouchend:function(e){this._removeTouchendHandler(m)},onMousewheel:function(e){if(r(this,"mouse","onMousewheel")===!1)return!1;this._addMousewheelHandler(m,e)},unbindOnMousewheel:function(e){this._removeMousewheelHandler(m)},mousePan:function(e,t){var n,i;if(r(this,"mouse","mousePan")===!1)return!1;this._ops._mousePan.excludeEntityIds||(this._ops._mousePan.excludeEntityIds=[]);if(typeof e=="undefined")this._ops._mousePan.disabled=!1;else if(typeof e=="string")switch(e){case"disable":this._ops._mousePan.disabled=!0;break;case"enable":this._ops._mousePan.disabled=!1;break;case"exclude":t.length||(i=t,t=[],t.push(i));for(n=0;n<t.length;n++)this._addMousePanExcludeEntityId(t[n]);break;case"include":t.length||(i=t,t=[],t.push(i));for(n=0;n<t.length;n++)this._removeMousePanExcludeEntityId(t[n])}else typeof e=="object"&&(e.disabled===!1||e.disabled===!0?this._ops._mousePan.disabled=e.disabled:this._ops._mousePan.disabled=!1,typeof e.excludeEntityIds!="undefined"&&e.excludeEntityIds!==!1?this._ops._mousePan.excludeEntityIds=typeof e.excludeEntityIds=="number"?[e.excludeEntityIds]:e.excludeEntityIds:e.excludeEntityIds===!1&&(this._ops._mousePan.excludeEntityIds=[]),typeof e.multiplier=="number"?this._ops._mousePan.multiplier=e.multiplier:typeof e.multiplier!="undefined"&&(this._ops._mousePan.multiplier=1),typeof e.start=="function"?this._mousePanStartdragHandler=e.start:typeof e.start!="undefined"&&(this._mousePanStartdragHandler=null),typeof e.drag=="function"?this._mousePanDragHandler=e.drag:typeof e.drag!="undefined"&&(this._mousePanDragHandler=null),typeof e.stop=="function"?this._mousePanStopdragHandler=e.stop:typeof e.stop!="undefined"&&(this._mousePanStopdragHandler=null))},isMousePanEnabled:function(){return!this._ops._mousePan.disabled},isMousePanning:function(){return!!this._mousePanDragging},touchPan:function(e,t){var n,i;if(r(this,"touch","touchPan")===!1)return!1;this._ops._touchPan.excludeEntityIds||(this._ops._touchPan.excludeEntityIds=[]);if(typeof e=="undefined")this._ops._touchPan.disabled=!1;else if(typeof e=="string")switch(e){case"disable":this._ops._touchPan.disabled=!0;break;case"enable":this._ops._touchPan.disabled=!1;break;case"exclude":t.length||(i=t,t=[],t.push(i));for(n=0;n<t.length;n++)this._addTouchPanExcludeEntityId(t[n]);break;case"include":t.length||(i=t,t=[],t.push(i));for(n=0;n<t.length;n++)this._removeTouchPanExcludeEntityId(t[n])}else typeof e=="object"&&(e.disabled===!1||e.disabled===!0?this._ops._touchPan.disabled=e.disabled:this._ops._touchPan.disabled=!1,typeof e.excludeEntityIds!="undefined"&&e.excludeEntityIds!==!1?this._ops._touchPan.excludeEntityIds=typeof e.excludeEntityIds=="number"?[e.excludeEntityIds]:e.excludeEntityIds:e.excludeEntityIds===!1&&(this._ops._touchPan.excludeEntityIds=[]),e.triggerWorldEvents===!1||e.triggerWorldEvents===!0?this._ops._touchPan.triggerWorldEvents=e.triggerWorldEvents:this._ops._touchPan.triggerWorldEvents=!0,e.allowPinch===!1||e.allowPinch===!0?this._ops._touchPan.allowPinch=e.allowPinch:this._ops._touchPan.allowPinch=!0,typeof e.multiplier=="number"?this._ops._touchPan.panMultiplier=e.multiplier:typeof e.multiplier!="undefined"&&(this._ops._touchPan.panMultiplier=1),typeof e.pinchMultiplier=="number"?this._ops._touchPan.pinchMultiplier=e.pinchMultiplier:typeof e.pinchMultiplier!="undefined"&&(this._ops._touchPan.pinchMultiplier=1),typeof e.start=="function"?this._touchPanStartdragHandler=e.start:typeof e.start!="undefined"&&(this._touchPanStartdragHandler=null),typeof e.drag=="function"?this._touchPanDragHandler=e.drag:typeof e.drag!="undefined"&&(this._touchPanDragHandler=null),typeof e.stop=="function"?this._touchPanStopdragHandler=e.stop:typeof e.stop!="undefined"&&(this._touchPanStopdragHandler=null),typeof e.startPinching=="function"?this._touchPanStartPinchingHandler=e.startPinching:typeof e.startPinching!="undefined"&&(this._touchPanStartPinchingHandler=null),typeof e.stopPinching=="function"?this._touchPanStopPinchingHandler=e.stopPinching:typeof e.stopPinching!="undefined"&&(this._touchPanStopPinchingHandler=null))},isTouchPanEnabled:function(){return!this._ops._touchPan.disabled},isTouchNotPanningNorPinching:function(){return this._touchPanDragging?!1:!0},isTouchPanning:function(){return this._touchPanDragging&&!this._touchPanDragging.pinchingInfos?!0:!1},isTouchPinching:function(){return this._touchPanDragging&&this._touchPanDragging.pinchingInfos?!0:!1},isAllowedToTriggerTouchEvents:function(){return!this._touchPanDragging||this._touchPanDragging&&this._ops._touchPan.triggerWorldEvents===!0?!0:!1},mousewheelZoom:function(e){if(r(this,"mouse","mousewheelZoom")===!1)return!1;if(typeof e=="undefined")this._ops._mousewheelZoom.disabled=!1;else if(typeof e=="string")switch(e){case"disable":this._ops._mousewheelZoom.disabled=!0;break;case"enable":this._ops._mousewheelZoom.disabled=!1}else typeof e=="object"&&(e.disabled===!1||e.disabled===!0?this._ops._mousewheelZoom.disabled=e.disabled:this._ops._mousewheelZoom.disabled=!1,typeof e.step=="number"?this._ops._mousewheelZoom.step=e.step:typeof e.step!="undefined"&&(this._ops._mousewheelZoom.step=.1))},isMousewheelZoomEnabled:function(){return!this._ops._mousewheelZoom.disabled}},y={name:"unnamed object",x:10,y:5,type:"dynamic",shape:"square",height:1,width:1,radius:1,points:[{x:0,y:0},{x:2,y:0},{x:0,y:2}],density:2,friction:1,restitution:.2,active:!0,rotation:null,fixedRotation:!1,bullet:!1,maxVelocityX:1e3,maxVelocityY:1e3,image:null,imageOffsetX:0,imageOffsetY:0,imageStretchToFit:null,color:"gray",borderColor:"black",borderWidth:1,spriteSheet:!1,spriteWidth:16,spriteHeight:16,spriteX:0,spriteY:0,_mouseDraggable:{disabled:!0,type:"regularDrag"},_touchDraggable:{disabled:!0,type:"regularDrag",maxTouches:100},init:null,draw:function(e,t,n){var r=-this._world._cameraX,i=-this._world._cameraY;e.fillStyle=typeof this._ops.color=="function"?this._ops.color.call(this,e):this._ops.color,e.strokeStyle=this._ops.borderColor,e.lineWidth=this._ops.borderWidth;var o,u=this._world._scale,a=this._world._ops.collisionOutlines,f=this._ops.imageOffsetX||0,l=this._ops.imageOffsetY||0;f*=u,l*=u;if(this._sprite!==undefined){var c,h;this._ops.shape==="circle"&&this._ops.imageStretchToFit?(c=h=this._ops.radius*2,t-=this._ops.radius/2*u,n-=this._ops.radius/2*u):this._ops.shape==="square"&&this._ops.imageStretchToFit?(c=this._ops.width,h=this._ops.height,t-=this._ops.width/4*u,n-=this._ops.height/4*u):this._ops.imageStretchToFit?(c=this._ops.width,h=this._ops.height):this._ops.spriteSheet?(c=this._ops.spriteWidth/30,h=this._ops.spriteHeight/30):(c=this._sprite.width/30,h=this._sprite.height/30);var p=f+(t+c/4*u),d=l+(n+h/4*u);e.translate(p,d),e.rotate(this._body.GetAngle()),this._ops.spriteSheet?e.drawImage(this._sprite,this._ops.spriteX*this._ops.spriteWidth,this._ops.spriteY*this._ops.spriteHeight,this._ops.spriteWidth,this._ops.spriteHeight,-(c/2*u),-(h/2*u),c*u,h*u):e.drawImage(this._sprite,-(c/2*u),-(h/2*u),c*u,h*u),e.rotate(0-this._body.GetAngle()),e.translate(-p,-d)}if(this._sprite&&!a)return;a&&(this._sprite!==undefined&&(e.fillStyle="transparent"),e.strokeStyle="rgb(255, 0, 255)",e.lineWidth=2);if(this._ops.shape==="polygon"||this._ops.shape==="square"){var v=this._body.GetFixtureList().GetShape(),m=parseInt(v.GetVertexCount(),10),g=v.GetVertices(),y=new Vector(m),b=this._body.m_xf;for(o=0;o<m;++o)y[o]=s.MulX(b,g[o]);e.beginPath(),e.moveTo((r+y[0].x)*u,(i+y[0].y)*u);for(o=1;o<y.length;o++)e.lineTo((r+y[o].x)*u,(i+y[o].y)*u);e.closePath(),(this._ops.borderWidth!==0||a)&&e.stroke(),e.fill()}else if(this._ops.shape==="circle"){var w=this.position();e.beginPath(),e.arc((r+w.x)*u,(i+w.y)*u,this._ops.radius*u,0,Math.PI*2,!0),e.closePath(),(this._ops.borderWidth!==0||a)&&e.stroke(),e.fill()}}},b={_id:null,_ops:null,_body:null,_world:null,_init:function(t,i,s){var f,l;i&&i.components!==undefined&&(i.components.reverse(),i.components.forEach(function(e){n(i,e)})),this._ops=n(i,y),f=this._ops,this._body=new o;var h=this._body;this._world=t,this._id=s;for(l in this._ops)l.match(/^\$/)&&(this[l]=this._ops[l]);var p=new a;p.density=f.density,p.friction=f.friction,p.restitution=f.restitution,h.position.x=f.x,h.position.y=f.y,this._name=f.name,f.type==="static"?h.type=u.b2_staticBody:f.type==="dynamic"&&(h.type=u.b2_dynamicBody),f.shape==="square"?(p.shape=new c.b2PolygonShape,p.shape.SetAsBox(f.width/2,f.height/2)):f.shape==="circle"?p.shape=new c.b2CircleShape(f.radius):f.shape==="polygon"&&(p.shape=new c.b2PolygonShape,p.shape.SetAsArray(f.points,f.points.length)),f.rotation&&(h.angle=f.rotation/e),f.draw&&(this._draw=f.draw),f.image&&(this._sprite=new Image,this._sprite.src=f.image),h.active=f.active,h.fixedRotation=f.fixedRotation,h.bullet=f.bullet,this._body=t._world.CreateBody(h),this._body.CreateFixture(p),this._body._bbid=s,f.onStartContact&&this._world._addStartContactHandler(s,f.onStartContact),f.onFinishContact&&this._world._addFinishContactHandler(s,f.onFinishContact),f.onImpact&&this._world._addImpactHandler(s,f.onImpact),f.onKeyDown?r(this,"key","onKeyDown")===!0&&this._world._addKeydownHandler(s,f.onKeyDown):f.onKeydown&&r(this,"key","onKeydown")===!0&&this._world._addKeydownHandler(s,f.onKeydown),f.onKeyUp?r(this,"key","onKeyUp")===!0&&this._world._addKeyupHandler(s,f.onKeyUp):f.onKeyup&&r(this,"key","onKeyup")===!0&&this._world._addKeydownHandler(s,f.onKeyup),f.onRender&&this.onRender(f.onRender),f.onTick&&this.onTick(f.onTick),f.onMousedown&&r(this,"mouse","onMousedown")===!0&&this._world._addMousedownHandler(s,f.onMousedown),f.onMouseup&&r(this,"mouse","onMouseup")===!0&&this._world._addMouseupHandler(s,f.onMouseup),f.onMousemove&&r(this,"mouse","onMousemove")===!0&&this._world._addMousemoveHandler(s,f.onMousemove),f.onMousein&&r(this,"mouse","onMousein")===!0&&this._world._addMouseinHandler(s,f.onMousein),f.onMouseout&&r(this,"mouse","onMouseout")===!0&&this._world._addMouseoutHandler(s,f.onMouseout),f.onMousewheel&&r(this,"mouse","onMousewheel")===!0&&this._world._addMousewheelHandler(s,f.onMousewheel),f.onTouchstart&&r(this,"touch","onTouchstart")===!0&&this._world._addTouchstartHandler(s,f.onTouchstart),f.onTouchend&&r(this,"touch","onTouchend")===!0&&this._world._addTouchendHandler(s,f.onTouchend),f.onTouchmove&&r(this,"touch","onTouchmove")===!0&&this._world._addTouchmoveHandler(s,f.onTouchmove),f.init&&f.init.call(this)},_toVector:function(e,t,n){var r,i;return t=t||0,n===undefined?(t-=90,r=Math.cos(t*(Math.PI/180))*e,i=Math.sin(t*(Math.PI/180))*e):(r=t*e,i=n*e),{x:r,y:i}},name:function(e){return e!==undefined&&(this._name=e),this._name},position:function(e){e!==undefined&&(this._world._world.IsLocked()?this._world._positionQueue.push({o:this,val:e}):this._body.SetPosition(new i(e.x,e.y)));var t=this._body.GetPosition();return{x:t.x,y:t.y}},checkPosition:function(e,t){var n;if(this._body.GetType()!==u.b2_staticBody)this._world._world.QueryPoint(function(e){n=e.GetBody()},new i(e,t));else{var r=new p;r.lowerBound.Set(e-.001,t-.001),r.upperBound.Set(e-.001,t-.001),this._world._world.QueryAABB(function(e){n=e.GetBody()},r)}return n!==undefined&&this._id===n._bbid?!0:!1},canvasPosition:function(e){e!==undefined;var t=this.position();return this._world.canvasPositionAt(t.x,t.y)},rotation:function(t){return t!==undefined&&this._body.SetAngle(t/e),this._body.GetAngle()*e},friction:function(e){return e!==undefined&&this._body.GetFixtureList().SetFriction(e),this._body.GetFixtureList().GetFriction()},restitution:function(e){return e!==undefined&&this._body.GetFixtureList().SetRestitution(e),this._body.GetFixtureList().GetRestitution()},maxVelocityX:function(e){return e!==undefined&&(this._ops.maxVelocityX=e),this._ops.maxVelocityX},maxVelocityY:function(e){return e!==undefined&&(this._ops.maxVelocityY=e),this._ops.maxVelocityY},image:function(e){return e!==undefined&&(this._sprite=new Image,this._sprite.src=e),this._sprite.src},imageOffsetX:function(e){return e!==undefined&&(this._ops.imageOffsetX=e),this._ops.imageOffsetX},imageOffsetY:function(e){return e!==undefined&&(this._ops.imageOffsetY=e),this._ops.imageOffsetY},imageStretchToFit:function(e){return e!==undefined&&(this._ops.imageStretchToFit=e),this._ops.imageStretchToFit},color:function(e){return e!==undefined&&(this._ops.color=e),this._ops.color},borderColor:function(e){return e!==undefined&&(this._ops.borderColor=e),this._ops.borderColor},borderWidth:function(e){return e!==undefined&&(this._ops.borderWidth=e),this._ops.borderWidth},spriteSheet:function(e){return e!==undefined&&(this._ops.spriteSheet=e),this._ops.spriteSheet},spriteWidth:function(e){return e!==undefined&&(this._ops.spriteWidth=e),this._ops.spriteWidth},spriteHeight:function(e){return e!==undefined&&(this._ops.spriteHeight=e),this._ops.spriteHeight},draw:function(e){return e!==undefined&&(this._draw=e),this._draw},destroy:function(){this._destroyed=!0,this._world._destroy(this)},applyImpulse:function(e,t,n){var r=this._toVector(e,t,n);this._world._applyImpulse(this._id,this._body,r.x,r.y)},setForce:function(e,t,n,r){var i=this._toVector(t,n,r);this._world._setConstantForce(e,this._id,this._body,i.x,i.y)},setVelocity:function(e,t,n,r){var i=this._toVector(t,n,r);this._world._setConstantVelocity(e,this._id,this._body,i.x,i.y)},clearForce:function(e){this._world._clearConstantForce(e,this._id)},clearVelocity:function(e){this._world._clearConstantVelocity(e,this._id)},onKeydown:function(e){if(r(this,"key","onKeydown")===!1)return!1;this._world._addKeydownHandler(this._id,e)},onKeyup:function(e){if(r(this,"key","onKeyup")===!1)return!1;this._world._addKeyupHandler(this._id,e)},onMousedown:function(e){if(r(this,"mouse","onMousedown")===!1)return!1;this._world._addMousedownHandler(this._id,e)},onMouseup:function(e){if(r(this,"mouse","onMouseup")===!1)return!1;this._world._addMouseupHandler(this._id,e)},onMousemove:function(e){if(r(this,"mouse","onMousemove")===!1)return!1;this._world._addMousemoveHandler(this._id,e)},unbindOnMousedown:function(){this._world._removeMousedownHandler(this._id)},unbindOnMouseup:function(){this._world._removeMouseupHandler(this._id)},unbindOnMousemove:function(){this._world._removeMousemoveHandler(this._id)},onMousein:function(e){if(r(this,"mouse","onMousein")===!1)return!1;this._world._addMouseinHandler(this._id,e)},onMouseout:function(e){if(r(this,"mouse","onMouseout")===!1)return!1;this._world._addMouseoutHandler(this._id,e)},unbindOnMousein:function(){this._world._removeMouseinHandler(this._id)},unbindOnMouseout:function(){this._world._removeMouseoutHandler(this._id)},onTouchstart:function(e){if(r(this,"touch","onTouchstart")===!1)return!1;this._world._addTouchstartHandler(this._id,e)},onTouchend:function(e){if(r(this,"touch","onTouchend")===!1)return!1;this._world._addTouchendHandler(this._id,e)},onTouchmove:function(e){if(r(this,"touch","onTouchmove")===!1)return!1;this._world._addTouchmoveHandler(this._id,e)},unbindOnTouchstart:function(){this._world._removeTouchstartHandler(this._id)},unbindOnTouchend:function(){this._world._removeTouchendHandler(this._id)},unbindOnTouchmove:function(){this._world._removeTouchmoveHandler(this._id)},onMousewheel:function(e){if(r(this,"mouse","onMousewheel")===!1)return!1;this._world._addMousewheelHandler(this._id,e)},unbindOnMousewheel:function(){this._world._removeMousewheelHandler(this._id)},onStartContact:function(e){this._world._addStartContactHandler(this._id,e)},onFinishContact:function(e){this._world._addFinishContactHandler(this._id,e)},onImpact:function(e){this._world._addImpactHandler(this._id,e)},onRender:function(e){this._world._onRender.push({fun:e,ctx:this})},onTick:function(e){this._world._onTick.push({fun:e,ctx:this})},sprite:function(e,t){this._ops.spriteX=e,this._ops.spriteY=t},pin:function(e,t){this.isPined()&&this.unPin();var n=this.position(),r,s,o,u;e=e||n.x,t=t||n.y,u=this._body.GetLocalPoint(new i(e,t)),s=u.x,o=u.y,r=new Box2D.Dynamics.Joints.b2RevoluteJointDef,r.bodyA=this._world._world.GetGroundBody(),r.bodyB=this._body,r.target&&r.target.Set?r.target.Set(e,t):r.localAnchorA.Set(e,t),r.localAnchorB.Set(s,o),r.maxForce=1e28,r.timeStep=1/60,this._pinJoint=this._world._world.CreateJoint(r)},unPin:function(){this._pinJoint&&(this._world._world.DestroyJoint(this._pinJoint),this._pinJoint=null)},isPined:function(){return this._pinJoint?!0:!1},mouseDraggable:function(e){if(r(this,"mouse","mouseDraggable")===!1)return!1;if(typeof e=="undefined")this._ops._mouseDraggable.disabled=!1;else if(typeof e=="string")switch(e){case"disable":this._ops._mouseDraggable.disabled=!0;break;case"enable":this._ops._mouseDraggable.disabled=!1}else typeof e=="object"&&(e.disabled===!1||e.disabled===!0?this._ops._mouseDraggable.disabled=e.disabled:this._ops._mouseDraggable.disabled=!1,typeof e.type=="string"&&(this._ops._mouseDraggable.type=e.type),typeof e.start=="function"?this._world._addMouseStartdragHandler(this._id,e.start):typeof e.start!="undefined"&&this._world._removeMouseStartdragHandler(this._id),typeof e.drag=="function"?this._world._addMouseDragHandler(this._id,e.drag):typeof e.drag!="undefined"&&this._world._removeMouseDragHandler(this._id),typeof e.stop=="function"?this._world._addMouseStopdragHandler(this._id,e.stop):typeof e.stop!="undefined"&&this._world._removeMouseStopdragHandler(this._id));this._ops._mouseDraggable.disabled===!1?this._world._addMouseDraggableEntityId(this._id):this._world._removeMouseDraggableEntityId(this._id)},isMouseDraggable:function(){return!this._ops._mouseDraggable.disabled},touchDraggable:function(e){if(r(this,"touch","touchDraggable")===!1)return!1;if(typeof e=="undefined")this._ops._touchDraggable.disabled=!1;else if(typeof e=="string")switch(e){case"disable":this._ops._touchDraggable.disabled=!0;break;case"enable":this._ops._touchDraggable.disabled=!1}else typeof e=="object"&&(e.disabled===!1||e.disabled===!0?this._ops._touchDraggable.disabled=e.disabled:this._ops._touchDraggable.disabled=!1,e.maxTouches>0?this._ops._touchDraggable.maxTouches=e.maxTouches:this._ops._touchDraggable.maxTouches=100,typeof e.type=="string"&&(this._ops._touchDraggable.type=e.type),typeof e.start=="function"?this._world._addTouchStartdragHandler(this._id,e.start):typeof e.start!="undefined"&&this._world._removeTouchStartdragHandler(this._id),typeof e.drag=="function"?this._world._addTouchDragHandler(this._id,e.drag):typeof e.drag!="undefined"&&this._world._removeTouchDragHandler(this._id),typeof e.stop=="function"?this._world._addTouchStopdragHandler(this._id,e.stop):typeof e.stop!="undefined"&&this._world._removeTouchStopdragHandler(this._id),typeof e.touchadd=="function"?this._world._addTouchAddtouchDragHandler(this._id,e.touchadd):typeof e.touchadd!="undefined"&&this._world._removeTouchAddtouchDragHandler(this._id),typeof e.touchremove=="function"?this._world._addTouchRemovetouchDragHandler(this._id,e.touchremove):typeof e.touchremove!="undefined"&&this._world._removeTouchRemovetouchDragHandler(this._id));this._ops._touchDraggable.disabled===!1?this._world._addTouchDraggableEntityId(this._id):this._world._removeTouchDraggableEntityId(this._id)},isTouchDraggable:function(){return!this._ops._touchDraggable.disabled}}}();